{% extends "base.html" %}
{% load i18n static wagtailcore_tags wagtailimages_tags user_tags %}
{% block body_class %}template-blogpage{% endblock %}
{% block content %}

<div class="bg-green-700 py-8 flex-grow">
    <div class="max-w-3xl md:max-w-5xl mx-auto p-4">
        <div class="bg-white rounded-xl overflow-hidden drop-shadow">

            <!-- Header -->
            <div class="relative aspect-w-16 aspect-h-4">
                {% if page.image %}
                    {% picture page.image format-{webp,avif,jpeg} fill-1024x320 bgcolor-3730a3 %}
                {% else %}
                    <div class="h-80 bg-gray-300"></div>
                {% endif %}
                <div class="h-full absolute top-0 p-4 w-full flex flex-col justify-end bg-gradient-to-t to-transparent from-yellow-500">
                    <h1 class="bold text-4xl mb-0 text-black">{{ page.title }}</h1>
                    <div class="flex items-center justify-between gap-4">
                        {{ page.specific.date | date:"d-m-Y H:i" }}
                        {% if page.author.author_page %}
                            <a href="{{ page.author.author_page.url }}" class="flex flex-row items-center gap-4 hover:underline">
                                <p class="text-sm italic">{% post_user_display_name page %}</p>
                                {% post_user_avatar page %}
                            </a>
                        {% else %}
                            <div class="flex flex-row items-center gap-4">
                                <p class="text-sm italic">{% post_user_display_name page %}</p>
                                {% post_user_avatar page %}
                            </div>
                        {% endif %}
                    </div>
                    <div class="flex ml-auto items-center gap-4">
                        {{ page.hero_text }}
                        {% if page.hero_cta_link %}
                            <a href="{% pageurl page.hero_cta_link %}" class="bg-blue-700 text-white px-4 py-2 rounded-lg no-underline hover:text-amber-300 transition-colors drop-shadow">
                                {% firstof page.hero_cta page.hero_cta_link.title %}
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Body -->
            <div class="p-4">
                {{ page.body|richtext }}
            </div>

            <!-- Google drive video -->
            {% if preview_url %}
                <div class="p-4 aspect-video">
                    <iframe 
                        src="{{preview_url}}" 
                        title="Video player"
                        class="h-full w-full bg-slate-300 rounded-xl"
                        frameBorder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowFullScreen
                        loading="lazy"
                    ></iframe>
                </div>
            {% endif %}


            <!-- Image Gallery -->
            <div class="p-4 grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for item in page.gallery_images.all %}
                    <div class="bg-white rounded-xl overflow-hidden drop-shadow group hover:rotate-3 transition-transform">
                        {% image item.image fill-1920x1080 %}
                        {{ item.caption }}
                    </div>
                {% endfor %}
            </div>
            
            <!-- Comments -->
            <div class="inline-block w-full">
                {% include "blog/includes/comments.html" with page=page %}
            </div>

            <!-- Return to blog button -->
            <a href="{{ page.get_parent.url }}" class="inline-block w-full p-4 bg-gray-100 text-center hover:bg-gray-200 transition-colors">
                ðŸ”™ {% trans "Return to blog" %}
            </a>
        </div>
    </div>
</div>

{% include "blog/includes/tukanchamon.html" %}
{% include "blog/includes/cuica-course-form.html" %}
{% endblock %}